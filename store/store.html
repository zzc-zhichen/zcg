<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>仓库管理</title>
    <link rel="stylesheet" href="../css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/iconfont.css">
    <link rel="stylesheet" href="../css/leftnav.css">
    <link rel="stylesheet" href="../css/stroe.css">
</head>
<body>
<nav>
    <div class="nav">
        仓库管理<i class="icon iconfont-cha"></i>
    </div>
    <div class="admin">
        <i class="icon iconfont-people"></i>
        <span class="username">张三</span>
        <i class="icon iconfont-shezhi shezhi"></i>
        <div class="edit">
            <ul class="edit-list">
                <li>关于中藏宫</li>
                <li>修改密码</li>
                <li>退出</li>
            </ul>
        </div>
    </div>
</nav>

<div class="cs-nav-left" id="accordion">
    <div class="cs-nav-left-top"></div>
    <div class="cs-nav-left-cen panel">
        <i class="icon iconfont-stroe"></i>
        <p id="stroeUrl" class="cs-nav-left-cen-t collapsed" id="headingOne" data-toggle="collapse" data-parent="#accordion"
           href="#collapseOne"
           aria-expanded="false" aria-controls="collapseOne">
            <i class="icon iconfont-menu"></i> 仓库管理
            <i class="icon iconfont-down"></i>
        </p>
        <ul id="collapseOne" class="cs-nav-left-cen-b collapse" aria-labelledby="headingOne">
            <li><a href="" style="color:#FFF;">添加仓库</a></li>
        </ul>
    </div>
    <div class="cs-nav-left-cen panel">
        <i class="icon iconfont-product"></i>
        <p id="productUrl" class="cs-nav-left-cen-t collapsed" id="headingTwo" data-toggle="collapse"
           data-parent="#accordion"
           href="#collapseTwo"
           aria-expanded="false" aria-controls="collapseTwo">
            <i class="icon iconfont-menu"></i> 商品管理
            <i class="icon iconfont-down"></i>
        </p>
        <ul class="cs-nav-left-cen-b collapse" id="collapseTwo" aria-labelledby="headingTwo">
            <li><a href="" style="color:#FFF;">添加商品</a></li>
            <li>添加套装</li>
            <li>添加周期</li>
        </ul>
    </div>
    <div class="cs-nav-left-cen panel">
        <i class="icon iconfont-dingdan"></i>
        <p class="cs-nav-left-cen-t collapsed" id="headingThree" data-toggle="collapse" data-parent="#accordion"
           href="#collapseThree"
           aria-expanded="false" aria-controls="collapseThree">
            <i class="icon iconfont-menu"></i> 订单管理
            <i class="icon iconfont-down"></i>
        </p>
        <ul class="cs-nav-left-cen-b collapse" id="collapseThree" aria-labelledby="headingThree">
            <li>代售订单</li>
            <li>售中订单</li>
            <li>已售订单</li>
        </ul>
    </div>
    <div class="cs-nav-left-cen panel">
        <i class="icon iconfont-xitong"></i>
        <p class="cs-nav-left-cen-t collapsed" id="headingFour" data-toggle="collapse" data-parent="#accordion"
           href="#collapseFour"
           aria-expanded="false" aria-controls="collapseFour">
            <i class="icon iconfont-menu"></i> 系统管理
            <i class="icon iconfont-down"></i>
        </p>
        <ul class="cs-nav-left-cen-b collapse" id="collapseFour" aria-labelledby="headingFour">
            <li>用户管理</li>
            <li>角色管理</li>
        </ul>
    </div>
</div>

<div class="content">
    <div class="seach">
        仓库编号<input id="seach_id" type="text">
        仓库名称<input id="seach_name" type="text">
        <button id="seach_sub">搜索</button>
    </div>
    <div class="add"><a href="/store/addstore.html"><i class="icon iconfont-add"></i>添加</a></div>
    <div class="table-responsive" style="margin: 0 auto;">
        <div class="table">
            <div class="thead">
                <ul class="clearfix">
                    <li>仓库编号</li>
                    <li>仓库名称</li>
                    <li>备注</li>
                    <li>操作</li>
                </ul>
            </div>
            <div class="tbody son_main">

            </div>
        </div>
    </div>
    
    <div class="pageContainer">
        <div class="main">
            <div class="page" id="page">

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                编辑仓库
                <i class="icon iconfont-cha" data-dismiss="modal" aria-label="Close"></i>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-id" class="control-label">仓库编码</label>
                        <input type="text" class="form-control" id="recipient-id" readonly="readonly">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">仓库名称</label>
                        <input type="text" class="form-control" id="recipient-name">
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="control-label">备注</label>
                        <textarea class="form-control" id="message-text"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary submit">确定</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="delModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                温馨提示
                <i class="icon iconfont-cha" data-dismiss="modal" aria-label="Close"></i>
            </div>
            <div class="modal-body">
                是否删除此仓库？
            </div>
            <div class="modal-footer">
                <button type="button" class="btn clo" data-dismiss="modal" aria-label="Close">关闭</button>
                <button type="button" class="btn btn-primary del_submit">确定</button>
            </div>
        </div>
    </div>
</div>




</body>
<script src="../lib/jquery.min.js"></script>
<script src="../lib/bootstrap.min.js"></script>
<script src="../lib/paging.js"></script>
<script src="../lib/template-web.js"></script>
<script src="../js/common.js"></script>
<script type="text/html" id="pro">
    {{each result as value}}
    <ul class="clearfix">
        <li class="r_id">{{value.id}}</li>
        <li class="r_name">{{value.name}}</li>
        <li class="r_desc">{{value.r_desc}}</li>
        <li>
            <a href="javascript:;"><i class="icon iconfont-shanchu del" data-toggle="modal" data-target="#delModal"></i></a>
            <a href="javascript:;"><i class="icon iconfont-bianji bianji" data-toggle="modal" data-target="#addModal"></i></a>
        </li>
    </ul>
    {{/each}}
</script>
<script>
    $(function () {
        $("#headingOne").removeClass("collapsed").attr("aria-expanded",true);
        $("#collapseOne").addClass("in");
            var pageNo = GetQueryString('pageNo')||1;
            var name = GetQueryString('name')||1;
            if (!/name=/.test(location.search)) {
                $.ajax({
                    url: "http://172.168.1.61:8080/ProductMaven/repository/get_repository_list",
                    dataType:'json',
                    type:'get',
                    data:{
                        pageSize:5,
                        pageNo:pageNo
                    },
                    success: function (data) {
                        var data1 = data.result;
                        var html = template('pro', {result:data1.listRepository});
                        $('.son_main').html(html);
                        $(".bianji").on("click",function () {
                            $("#recipient-id").val($(this).parent().parent().siblings(".r_id").text());
                            $("#recipient-name").val($(this).parent().parent().siblings(".r_name").text());
                            $("#message-text").val($(this).parent().parent().siblings(".r_desc").text());
                            console.log($(this).parent().parent().siblings(".r_id").text());
                        });
                        $(".del").on("click",function () {
                            console.log($(this).parent().parent().siblings(".r_id").text());
                            var del_id = $(this).parent().parent().siblings(".r_id").text();
                            $(".del_submit").on("click",function () {
                                $.ajax({
                                    url: "http://172.168.1.61:8080/ProductMaven/repository/delete_repository_by_id",
                                    dataType:'json',
                                    type:'get',
                                    data:{
                                        id:del_id
                                    },
                                    success: function (data) {
                                        if (!(data1.listRepository.length === 1)) {
                                            window.location.href = location.href;
                                        }else{
                                            window.location.href = "/store/store.html"
                                        }
                                    }
                                });
                            });
                        });
                        //分页
                        $("#page").paging({
                            totalPage: data1.pageController.totalPages,
                            pageNo:pageNo,
                            callback: function(num) {
                                console.log(num)
                            }
                        })
                    }
                });
            }else {
                $.ajax({
                    url: "http://172.168.1.61:8080/ProductMaven/repository/get_repository_list",
                    dataType:'json',
                    type:'get',
                    data:{
                        pageSize:5,
                        pageNo:pageNo,
                        name:name
                    },
                    success: function (data) {
                        var data1 = data.result;
                        var html = template('pro', {result:data1.listRepository});
                        $('.son_main').html(html);
                        $("#seach_name").val(name);
                        $(".bianji").on("click",function () {
                            $("#recipient-id").val($(this).parent().parent().siblings(".r_id").text());
                            $("#recipient-name").val($(this).parent().parent().siblings(".r_name").text());
                            $("#message-text").val($(this).parent().parent().siblings(".r_desc").text());
                        });
                        $(".del").on("click",function () {
                            console.log($(this).parent().parent().siblings(".r_id").text());
                            var del_id = $(this).parent().parent().siblings(".r_id").text();
                            $(".del_submit").on("click",function () {
                                $.ajax({
                                    url: "http://172.168.1.61:8080/ProductMaven/repository/delete_repository_by_id",
                                    dataType:'json',
                                    type:'get',
                                    data:{
                                        id:del_id
                                    },
                                    success: function (data) {
                                        if (!(data1.listRepository.length === 1)) {
                                            window.location.href = location.href;
                                        }else{
                                            window.location.href = "/store/store.html"
                                        }
                                    }
                                });
                            });
                        });
                        //分页
                        $("#page").paging({
                            totalPage: data1.pageController.totalPages,
                            pageNo:pageNo,
                            callback: function(num) {

                            }
                        })
                    }
                });
            }
            $(".submit").on("click",function () {
                $.ajax({
                    url: "http://172.168.1.61:8080/ProductMaven/repository/update_repository",
                    dataType:'json',
                    type:'post',
                    data:{
                        id:$("#recipient-id").val(),
                        name:$("#recipient-name").val(),
                        r_desc:$("#message-text").val()
                    },
                    success: function (data) {
                        window.location.href = location.href;
                    }
                });
            });
            $("#seach_sub").on("click",function () {
                $.ajax({
                    url: "http://172.168.1.61:8080/ProductMaven/repository/get_repository_list",
                    dataType:'json',
                    type:'get',
                    data:{
                        pageSize:5,
                        pageNo:1,
                        id:$("#seach_id").val(),
                        name:$("#seach_name").val()
                    },
                    success: function (data) {
                        var data = data.result;
                        if (data.listRepository.length){
                            console.log($("#seach_name").val());
                            var html = template('pro', {result:data.listRepository});
                            $('.son_main').html(html);
                            var val = $("#seach_name").val();
                            $("#seach_name").val(val);
                            var parm;
                            if($("#seach_id").val()&&$("#seach_name").val()){
                                parm ="id="+$("#seach_id").val();
                            }else if($("#seach_id").val()&&!$("#seach_name").val()) {
                                parm ="id="+$("#seach_id").val()+"&pageNo=1";
                            }else if(!$("#seach_id").val()&&$("#seach_name").val()) {
                                parm ="name="+$("#seach_name").val()+"&pageNo=1";
                            }
                            console.log(parm);
                            setPageParam(parm);
                            var locahref = location.href;
                            //分页
                            $("#page").paging({
                                totalPage: data.pageController.totalPages,
                                pageNo:1,
                                totalHref:locahref,
                                callback: function(num) {
//                                console.log(num)
                                }
                            })
                        }else {
                            alert(1);
                            $(".son_main").html('<div>无此仓库</div>');
                        }

                    }
                });
            });
        })
</script>
</html>